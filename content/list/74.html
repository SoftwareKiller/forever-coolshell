<!DOCTYPE html><!--[if IE 8]>
<html id="ie8" dir="ltr" lang="zh-CN"
	prefix="og: https://ogp.me/ns#" >
<![endif]--><!--[if !(IE 8) ]><!--><html dir="ltr" lang="zh-CN" prefix="og: https://ogp.me/ns#"><!--<![endif]--><head><meta charset="UTF-8"/><title>酷壳 – CoolShell.cn - Part 74</title><link rel="stylesheet" type="text/css" href="/assets/all.min.css"/><link rel="shortcut icon" href="/assets/favicon.png"/></head>
<body class="home blog paged paged-74 group-blog">

<div id="page" class="hfeed site">
<header id="masthead" role="banner">

<div id="cc_spacer"></div>
<div class="site-header">

<div class="site-branding">
<a class="home-link" href="/" title="酷 壳 – CoolShell" rel="home">
<h1 class="site-title">酷 壳 – CoolShell</h1>
<h2 class="site-description">享受编程和技术所带来的快乐 – Coding Your Ambition</h2>
</a>
</div>
</div>
</header>
<div class="container">
<div class="row">

</div>
</div>
<div id="content" class="site-content">
<div class="container">
<div class="row">
<div id="primary" class="content-area  col-md-12" style="margin-top: 40px;">
<main id="main" class="site-main" role="main">
<article id="post-14" class="post-content post-14 post type-post status-publish format-standard hentry category-javadev category-techarticle category-proglanguage tag-book tag-java">
<header class="entry-header">
<span class="screen-reader-text">Java书籍Top 10</span>
<h2 class="entry-title">
<a href="/articles/14.html" rel="bookmark">Java书籍Top 10</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/14.html" title="13:43" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:43:06+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/14.html#comments" class="comments-link">4 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 28,019 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>下面是<a href="http://www.kiatemy.com/" target="_blank">Java Inside</a>上推荐的十本不错的Java书籍。（<a href="http://www.kiatemy.com/?p=93" target="_blank">文章来源</a>）</p>
<p><a href="http://www.kiatemy.com/wp-content/uploads/2009/01/jls3e.jpg" target="_blank"></a></p>
<p style="text-align: left;"><img decoding="async" class="alignright" src="http://images.china-pub.com/ebook30001-35000/30979/zcover.jpg" border="0" alt="Java编程规范（第三版）"/></p>
<p style="text-align: left;"> <span style="color: #787878; font-family: Arial;"> </span><strong>1）Java Language Specification, <em>Third Edition</em></strong> (<em>by James Gosling</em>) </p>
<p>本书由Java技术的发明者编写，是Java TM编程语言的权威性技术指南。如果你想知道语言之构造的精确含义，本书是最好的资源。</p>
<p>中文版链接：《<a href="http://www.china-pub.com/30979" target="_blank">Java编程规范</a>》<br/>
英文版链接：《<a href="https://www.amazon.com/gp/product/0321246780/qid=1151978234/sr=11-1/ref=sr_11_1/103-0196201-4410255?n=283155" target="_blank">The Java Language Specification (3rd Edition) </a>》</p>
<p> <a href="/articles/14.html#more-14" class="more-link">…</a></p><a href="/articles/14.html#more-14" class="more-link">
</a><p class="read-more"><a href="/articles/14.html#more-14" class="more-link"></a><a class="btn btn-default" href="/articles/14.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-14-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-11" class="post-content post-11 post type-post status-publish format-standard hentry category-phpdev category-webdev category-proglanguage tag-php">
<header class="entry-header">
<span class="screen-reader-text">PHP v5.3的新鲜玩意</span>
<h2 class="entry-title">
<a href="/articles/11.html" rel="bookmark">PHP v5.3的新鲜玩意</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/11.html" title="13:40" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:40:50+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/11.html#comments" class="comments-link">2 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 7,397 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>PHP v5.3马上就要release了，这里让我们看看他有一些什么样的新特性。</p>
<p><strong>1）_callStatic() magic 方法</strong></p>
<pre data-enlighter-language="php" class="EnlighterJSRAW">class Foo
{
    public static function __callStatic( $name, $args )
    {
        echo &#34;Called method $name statically&#34;;
    } 

    public function __call( $name, $args )
    {
        echo &#34;Called method $name&#34;;
    }
}</pre>
<p> <a href="/articles/11.html#more-11" class="more-link">…</a></p><a href="/articles/11.html#more-11" class="more-link">
</a><p class="read-more"><a href="/articles/11.html#more-11" class="more-link"></a><a class="btn btn-default" href="/articles/11.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-11-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-9" class="post-content post-9 post type-post status-publish format-standard hentry category-ajaxdev category-webdev category-proglanguage tag-ajax">
<header class="entry-header">
<span class="screen-reader-text">你应该知道的20个Ajax技术(11-20)</span>
<h2 class="entry-title">
<a href="/articles/9.html" rel="bookmark">你应该知道的20个Ajax技术(11-20)</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/9.html" title="13:36" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:36:00+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/9.html#comments" class="comments-link">3 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 9,238 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p><strong>11) 表单字段帮助信息的自动提示</strong></p>
<p>增强WEB表单的Usability有很多很多的方法，在网上一搜一大片，然后有些时候，用户会被表单搞得很混乱，而且，不同的用户会对表单有不同的理解，其输入也是千奇百怪。所以，为表单字段增加一下自动帮助信息的提示绝对是非常不错的选择。这点在淘宝网上表现得比较出现。下面是一个非常简单短小的教程。</p>
<p><a href="https://woork.blogspot.com/2008/04/improve-form-usability-with-auto.html" target="_blank">http://woork.blogspot.com/2008/04/improve-form-usability-with-auto.html</a></p>
<p><img decoding="async" src="http://nettuts.s3.amazonaws.com/090_20ajax/10.png" alt=""/></p>
<p>  <a href="/articles/9.html#more-9" class="more-link">…</a></p><a href="/articles/9.html#more-9" class="more-link">
</a><p class="read-more"><a href="/articles/9.html#more-9" class="more-link"></a><a class="btn btn-default" href="/articles/9.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-9-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-7" class="post-content post-7 post type-post status-publish format-standard hentry category-ajaxdev category-webdev category-proglanguage tag-ajax">
<header class="entry-header">
<span class="screen-reader-text">你应该知道的20个Ajax技术(01-10)</span>
<h2 class="entry-title">
<a href="/articles/7.html" rel="bookmark">你应该知道的20个Ajax技术(01-10)</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/7.html" title="13:34" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:34:46+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/7.html#comments" class="comments-link">1 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 1,321 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p><strong>1) TextboxList自动完成 （</strong><a href="http://devthought.com/textboxlist-meets-autocompletion/" target="_blank"><strong>源码</strong></a><strong>，</strong><a href="http://devthought.com/wp-content/articles/autocompletelist/test.html" target="_blank"><strong>演示</strong></a><strong>）</strong></p>
<p>这个控件主要来自Facebook吧，在网易的邮件里也能看到，还有hotmail等等，在文本框里输入文本不但可以出现相关数据的列表，而且选中后的字符串还会变成一个小图标。这个控件主要用在电子邮件中吧。<br/>
<img decoding="async" src="http://nettuts.s3.amazonaws.com/090_20ajax/1.png" alt=""/></p>
<p> <a href="/articles/7.html#more-7" class="more-link">…</a></p><a href="/articles/7.html#more-7" class="more-link">
</a><p class="read-more"><a href="/articles/7.html#more-7" class="more-link"></a><a class="btn btn-default" href="/articles/7.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-7-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-5" class="post-content post-5 post type-post status-publish format-standard hentry category-javadev category-proglanguage tag-java">
<header class="entry-header">
<span class="screen-reader-text">Java EE6 初探</span>
<h2 class="entry-title">
<a href="/articles/5.html" rel="bookmark">Java EE6 初探</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/5.html" title="13:33" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:33:45+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/articles/author/neo" title="View all posts by Neo" rel="author">Neo</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/5.html#respond" class="comments-link">没有评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 191 人阅读</h5>
</div>
</header>
<div class="entry-content">
<div class="item_t">
<div id="item_desc_944813350" class="item_desc" style="display: inline;">在<a title="TSS" href="http://www.theserverside.com/" target="_blank">tss</a>上，Reza Rahman发表了一篇关于JAVA EE6<a title="《Java EE6 Overview》" href="http://www.theserverside.com/tt/articles/article.tss?l=JavaEE6Overview" target="_blank">《Java EE6 Overview》</a>的文章，在文章里面他谈及一些关于JavaEE6草案的一些修改内容。</div>
</div>
<p>想JAVA企业级应用一路走来，从J2ee到Java EE5 在到即将要推出的Java EE6经历了一个由复杂到简单，由繁到简的过程。</p>
<p>Reza Rahman 文章说，Java EE6将会更简单，更轻量级，更易部署，Java EE6将会裁剪到Java EE5中不实用的部分。并且Java EE6将会为不同的用户群提供不同的规范子集。</p>
<p>回顾上一版本Java EE 5中，主要引入了以下改变：<br/>
1）引入了EJB3.0<br/>
2）引入了JSF作Tier framework.<br/>
3）使用JAX-WS2.0取代了JAX-RPC作新一代的SOAP的Web service API<br/>
4）使用POJO编程，零配置系统和自由的XML减轻了系统的复杂性。</p>
<p> <a href="/articles/5.html#more-5" class="more-link">…</a></p><a href="/articles/5.html#more-5" class="more-link">
</a><p class="read-more"><a href="/articles/5.html#more-5" class="more-link"></a><a class="btn btn-default" href="/articles/5.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-5-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-3" class="post-content post-3 post type-post status-publish format-standard hentry category-webdev category-misc tag-icons tag-web">
<header class="entry-header">
<span class="screen-reader-text">50套Web开发图标</span>
<h2 class="entry-title">
<a href="/articles/3.html" rel="bookmark">50套Web开发图标</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/3.html" title="13:31" rel="bookmark"><time class="entry-date" datetime="2009-03-02T13:31:43+08:00" pubdate="">2009年03月02日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/3.html#comments" class="comments-link">5 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 10,274 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>下面是号称最好的50套WEB开发的图标。来源：<a href="http://speckyboy.com/2009/02/02/50-of-the-best-ever-web-development-design-and-application-icon-sets" target="_blank">链接</a></p>
<p>其它相关的一些文章</p>
<ul>
<li><a href="http://speckyboy.com/2009/01/26/30-amazingly-creative-social-bookmarks-icon-sets" target="_blank">30 Amazingly Creative Social Bookmarks Icon Sets ?</a></li>
<li><a href="http://speckyboy.com/2009/01/22/42-amazing-photoshop-and-illustrator-icon-design-tutorials" target="_blank">42 Amazing Photoshop and Illustrator Icon Design Tutorials ?</a></li>
<li><a href="http://speckyboy.com/2008/07/18/35-free-icon-sets-for-your-iphone-pimp-it-up" target="_blank">35 Free Icon Sets for your iPhone – Pimp it Up! ?</a></li>
<li><a href="http://speckyboy.com/2008/05/03/top-12-icon-design-video-tutorials" target="_blank">Top 12 Icon Design Video Tutorials ?</a></li>
<li><a href="http://speckyboy.com/2008/05/03/top-5-free-icon-editors-for-the-pro-designer" target="_blank">Top 5 Free Icon Editors for the Pro Designer ?</a></li>
<li><a href="http://speckyboy.com/2008/02/05/the-best-icon-search-engines-and-features-for-designers" target="_blank">The Best Icon Search Engines and Features for Designers ?</a></li>
</ul>
<p> <a href="/articles/3.html#more-3" class="more-link">…</a></p><a href="/articles/3.html#more-3" class="more-link">
</a><p class="read-more"><a href="/articles/3.html#more-3" class="more-link"></a><a class="btn btn-default" href="/articles/3.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-3-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-12176" class="post-content post-12176 post type-post status-publish format-standard hentry category-cplusplus category-proglanguage tag-c">
<header class="entry-header">
<span class="screen-reader-text">C++ 对象的内存布局</span>
<h2 class="entry-title">
<a href="/articles/12176.html" rel="bookmark">C++ 对象的内存布局</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/12176.html" title="09:32" rel="bookmark"><time class="entry-date" datetime="2008-10-15T09:32:16+08:00" pubdate="">2008年10月15日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/12176.html#comments" class="comments-link">18 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 52,452 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>07年12月，我写了一篇《<a title="C++ 虚函数表解析" href="/articles/12165.html" target="_blank">C++虚函数表解析</a>》的文章，引起了大家的兴趣。有很多朋友对我的文章留了言，有鼓励我的，有批评我的，还有很多问问题的。我在这里一并对大家的留言表示感谢。这也是我为什么再写一篇续言的原因。因为，在上一篇文章中，我用了的示例都是非常简单的，主要是为了说明一些机理上的问题，也是为了图一些表达上方便和简单。不想，这篇文章成为了打开C++对象模型内存布局的一个引子，引发了大家对C++对象的更深层次的讨论。当然，我之前的文章还有很多方面没有涉及，从我个人感觉下来，在谈论虚函数表里，至少有以下这些内容没有涉及：</p>
<p style="padding-left: 30px;">1）有成员变量的情况。</p>
<p style="padding-left: 30px;">2）有重复继承的情况。</p>
<p style="padding-left: 30px;">3）有虚拟继承的情况。</p>
<p style="padding-left: 30px;">4）有钻石型虚拟继承的情况。</p>
<p> 这些都是我本篇文章需要向大家说明的东西。所以，这篇文章将会是《<a href="/articles/12165.html" target="_blank">C++虚函数表解析</a>》的一个续篇，也是一篇高级进阶的文章。我希望大家在读这篇文章之前对C++有一定的基础和了解，并能先读我的上一篇文章。因为这篇文章的深度可能会比较深，而且会比较杂乱，我希望你在读本篇文章时不会有大脑思维紊乱导致大脑死机的情况。;-)</p>
<h4>对象的影响因素</h4>
<p>简而言之，我们一个类可能会有如下的影响因素：</p>
<p style="padding-left: 30px;">1）成员变量</p>
<p style="padding-left: 30px;">2）虚函数（产生虚函数表）</p>
<p style="padding-left: 30px;">3）单一继承（只继承于一个类）</p>
<p style="padding-left: 30px;">4）多重继承（继承多个类）</p>
<p style="padding-left: 30px;">5）重复继承（继承的多个父类中其父类有相同的超类）</p>
<p style="padding-left: 30px;">6）虚拟继承（使用virtual方式继承，为了保证继承后父类的内存布局只会存在一份）</p>
<p>上述的东西通常是C++这门语言在语义方面对对象内部的影响因素，当然，还会有编译器的影响（比如优化），还有字节对齐的影响。在这里我们都不讨论，我们只讨论C++语言上的影响。</p>
<p>本篇文章着重讨论下述几个情况下的C++对象的内存布局情况。</p>
<p> <a href="/articles/12176.html#more-12176" class="more-link">…</a></p><a href="/articles/12176.html#more-12176" class="more-link">
</a><p class="read-more"><a href="/articles/12176.html#more-12176" class="more-link"></a><a class="btn btn-default" href="/articles/12176.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-12176-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-12165" class="post-content post-12165 post type-post status-publish format-standard hentry category-cplusplus category-proglanguage tag-c">
<header class="entry-header">
<span class="screen-reader-text">C++ 虚函数表解析</span>
<h2 class="entry-title">
<a href="/articles/12165.html" rel="bookmark">C++ 虚函数表解析</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/12165.html" title="09:08" rel="bookmark"><time class="entry-date" datetime="2007-12-18T09:08:02+08:00" pubdate="">2007年12月18日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/12165.html#comments" class="comments-link">39 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 50,070 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>C++中的虚函数的作用主要是实现了多态的机制。关于多态，简而言之就是用父类型别的指针指向其子类的实例，然后通过父类的指针调用实际子类的成员函数。这种技术可以让父类的指针有“多种形态”，这是一种泛型技术。所谓泛型技术，说白了就是试图使用不变的代码来实现可变的算法。比如：模板技术，RTTI技术，虚函数技术，要么是试图做到在编译时决议，要么试图做到运行时决议。</p>
<p>关于虚函数的使用方法，我在这里不做过多的阐述。大家可以看看相关的C++的书籍。在这篇文章中，我只想从虚函数的实现机制上面为大家 一个清晰的剖析。</p>
<p>当然，相同的文章在网上也出现过一些了，但我总感觉这些文章不是很容易阅读，大段大段的代码，没有图片，没有详细的说明，没有比较，没有举一反三。不利于学习和阅读，所以这是我想写下这篇文章的原因。也希望大家多给我提意见。</p>
<p>言归正传，让我们一起进入虚函数的世界。</p>
<h4>虚函数表</h4>
<p>对C++ 了解的人都应该知道虚函数（Virtual Function）是通过一张虚函数表（Virtual Table）来实现的。简称为V-Table。在这个表中，主是要一个类的虚函数的地址表，这张表解决了继承、覆盖的问题，保证其容真实反应实际的函数。这样，在有虚函数的类的实例中这个表被分配在了这个实例的内存中，所以，当我们用父类的指针来操作一个子类的时候，这张虚函数表就显得由为重要了，它就像一个地图一样，指明了实际所应该调用的函数。</p>
<p>这里我们着重看一下这张虚函数表。C++的编译器应该是保证虚函数表的指针存在于对象实例中最前面的位置（这是为了保证取到虚函数表的有最高的性能——如果有多层继承或是多重继承的情况下）。 这意味着我们通过对象实例的地址得到这张虚函数表，然后就可以遍历其中函数指针，并调用相应的函数。</p>
<p>听我扯了那么多，我可以感觉出来你现在可能比以前更加晕头转向了。 没关系，下面就是实际的例子，相信聪明的你一看就明白了。</p>
<p> <a href="/articles/12165.html#more-12165" class="more-link">…</a></p><a href="/articles/12165.html#more-12165" class="more-link">
</a><p class="read-more"><a href="/articles/12165.html#more-12165" class="more-link"></a><a class="btn btn-default" href="/articles/12165.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-12165-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-12192" class="post-content post-12192 post type-post status-publish format-standard hentry category-cplusplus category-proglanguage tag-c">
<header class="entry-header">
<span class="screen-reader-text">C/C++返回内部静态成员的陷阱</span>
<h2 class="entry-title">
<a href="/articles/12192.html" rel="bookmark">C/C++返回内部静态成员的陷阱</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/12192.html" title="10:12" rel="bookmark"><time class="entry-date" datetime="2006-11-16T10:12:11+08:00" pubdate="">2006年11月16日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/12192.html#comments" class="comments-link">8 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 16,556 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p align="left">在我们用C/C++开发的过程中，总是有一个问题会给我们带来苦恼。这个问题就是函数内和函数外代码需要通过一块内存来交互（比如，函数返回字符串），这个问题困扰和很多开发人员。如果你的内存是在函数内栈上分配的，那么这个内存会随着函数的返回而被弹栈释放，所以，你一定要返回一块函数外部还有效的内存。</p>
<p>这是一个让无数人困扰的问题。如果你一不小心，你就很有可能在这个上面犯错误。当然目前有很多解决方法，如果你熟悉一些标准库的话，你可以看到许多各式各样的解决方法。大体来说有下面几种：</p>
<p>1）在函数内部通过malloc或new在堆上分配内存，然后把这块内存返回（因为在堆上分配的内存是全局可见的）。这样带来的问题就是潜在的内存问题。因为，如果返回出去的内存不释放，那么就是memory Leak。或者是被多次释放，从而造成程序的crash。这两个问题都相当的严重，所以这种设计方法并不推荐。（在一些Windows API中，当你调用了一些API后，你必需也要调用他的某些API来释放这块内存）</p>
<p>2）让用户传入一块他自己的内存地址，而在函数中把要返回的内存放到这块内存中。这是一个目前普遍使用的方式。很多Windows API函数或是标准C函数都需要你传入一个buffer和这个buffer的长度。这种方式对我们来说应该是屡见不鲜了。这种方式的好处就是由函数外部的程序来维护这块内存，比较简显直观。但问题就是在使用上稍许有些麻烦。不过这种方式把犯错误的机率减到了最低。</p>
<p>3）第三种方式显得比较另类，他利用了static的特性，static的栈内存一旦分配，那这块内存不会随着函数的返回而释放，而且，它是全局可见的（只要你有这块内存的地址）。所以，有一些函数使用了static的这个特性，即不用使用堆上的内存，也不需要用户传入一个buffer和其长度。从而，使用得自己的函数长得很漂亮，也很容易使用。</p>
<p>这里，我想对第三个方法进行一些讨论。使用static内存这个方法看似不错，但是它有让你想象不到的陷阱。让我们来用一个实际发生的案例来举一个例子吧。</p>
<p> <a href="/articles/12192.html#more-12192" class="more-link">…</a></p><a href="/articles/12192.html#more-12192" class="more-link">
</a><p class="read-more"><a href="/articles/12192.html#more-12192" class="more-link"></a><a class="btn btn-default" href="/articles/12192.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-12192-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<article id="post-12199" class="post-content post-12199 post type-post status-publish format-standard hentry category-cplusplus category-proglanguage tag-c tag-stl tag-string">
<header class="entry-header">
<span class="screen-reader-text">C++ STL string的Copy-On-Write技术</span>
<h2 class="entry-title">
<a href="/articles/12199.html" rel="bookmark">C++ STL string的Copy-On-Write技术</a>
</h2>
<div class="entry-meta">
<h5 class="entry-date"><i class="fa fa-calendar-o"></i> <a href="/articles/12199.html" title="10:36" rel="bookmark"><time class="entry-date" datetime="2004-06-23T10:36:50+08:00" pubdate="">2004年06月23日 </time></a><span class="byline"><span class="sep"></span><i class="fa fa-user"></i>
<span class="author vcard"><a class="url fn n" href="/haoel" title="View all posts by 陈皓" rel="author">陈皓</a></span></span> <i class="fa fa-comments-o"></i><span class="screen-reader-text">评论 </span> <a href="/articles/12199.html#comments" class="comments-link">16 条评论</a> <i class="fa fa-users" style="margin-left:10px;"></i> 32,808 人阅读</h5>
</div>
</header>
<div class="entry-content">
<p>Scott Meyers在《More Effective C++》中举了个例子，不知你是否还记得？在你还在上学的时候，你的父母要你不要看电视，而去复习功课，于是你把自己关在房间里，做出一副正在复习功课的样子，其实你在干着别的诸如给班上的某位女生写情书之类的事，而一旦你的父母出来在你房间要检查你是否在复习时，你才真正捡起课本看书。这就是“拖延战术”，直到你非要做的时候才去做。</p>
<p>当然，这种事情在现实生活中时往往会出事，但其在编程世界中摇身一变，就成为了最有用的技术，正如C++中的可以随处声明变量的特点一样，Scott Meyers推荐我们，在真正需要一个存储空间时才去声明变量（分配内存），这样会得到程序在运行时最小的内存花销。执行到那才会去做分配内存这种比较耗时的工作，这会给我们的程序在运行时有比较好的性能。必竟，20%的程序运行了80%的时间。</p>
<p>当然，拖延战术还并不只是这样一种类型，这种技术被我们广泛地应用着，特别是在操作系统当中，当一个程序运行结束时，操作系统并不会急着把其清除出内存，原因是有可能程序还会马上再运行一次（从磁盘把程序装入到内存是个很慢的过程），而只有当内存不够用了，才会把这些还驻留内存的程序清出。</p>
<p>写时才拷贝（Copy-On-Write）技术，就是编程界“懒惰行为”——拖延战术的产物。举个例子，比如我们有个程序要写文件，不断地根据网络传来的数据写，如果每一次fwrite或是fprintf都要进行一个磁盘的I/O操作的话，都简直就是性能上巨大的损失，因此通常的做法是，每次写文件操作都写在特定大小的一块内存中（磁盘缓存），只有当我们关闭文件时，才写到磁盘上（这就是为什么如果文件不关闭，所写的东西会丢失的原因）。更有甚者是文件关闭时都不写磁盘，而一直等到关机或是内存不够时才写磁盘，Unix就是这样一个系统，如果非正常退出，那么数据就会丢失，文件就会损坏。</p>
<p>呵呵，为了性能我们需要冒这样大的风险，还好我们的程序是不会忙得忘了还有一块数据需要写到磁盘上的，所以这种做法，还是很有必要的。</p>
<p> <a href="/articles/12199.html#more-12199" class="more-link">…</a></p><a href="/articles/12199.html#more-12199" class="more-link">
</a><p class="read-more"><a href="/articles/12199.html#more-12199" class="more-link"></a><a class="btn btn-default" href="/articles/12199.html"> 阅读全文<span class="screen-reader-text"> Read More</span></a></p>
<p></p>
<div id="post-ratings-12199-loading" class="post-ratings-loading"><img src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16" height="16" class="post-ratings-image"/>Loading...</div>
</div>
<footer class="entry-footer">
</footer>
</article>
<nav class="navigation posts-navigation" role="navigation">
<h2 class="screen-reader-text">Posts navigation</h2>
<div class="nav-links">
<div class="row">
<div class="wp-pagenavi" role="navigation">
<span class="pages">第 74 / 74 页</span><a class="first" aria-label="First Page" href="/">« 首页</a><a class="previouspostslink" rel="prev" aria-label="上一页" href="/page/73.html">«</a><span class="extend">...</span><a class="smaller page" title="第 10 页" href="/page/10.html">10</a><a class="smaller page" title="第 20 页" href="/page/20.html">20</a><a class="smaller page" title="第 30 页" href="/page/30.html">30</a><a class="smaller page" title="第 40 页" href="/page/40.html">40</a><a class="smaller page" title="第 50 页" href="/page/50.html">50</a><span class="extend">...</span><a class="page smaller" title="第 65 页" href="/page/65.html">65</a><a class="page smaller" title="第 66 页" href="/page/66.html">66</a><a class="page smaller" title="第 67 页" href="/page/67.html">67</a><a class="page smaller" title="第 68 页" href="/page/68.html">68</a><a class="page smaller" title="第 69 页" href="/page/69.html">69</a><a class="page smaller" title="第 70 页" href="/page/70.html">70</a><a class="page smaller" title="第 71 页" href="/page/71.html">71</a><a class="page smaller" title="第 72 页" href="/page/72.html">72</a><a class="page smaller" title="第 73 页" href="/page/73.html">73</a><span aria-current="page" class="current">74</span>
</div>
</div>
</div>
</nav>
</main>
</div>

</div>
</div>

</div>

</div>
















</body></html>